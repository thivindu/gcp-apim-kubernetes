# Default values for wso2-apim-kubernetes
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Namespace configuration
namespace:
  # Create the namespace if it doesn't exist
  create: false
  # Name of the namespace where all components will be deployed
  name: apim-kubernetes

# Nginx Ingress Controller configuration
nginxIngress:
  # Enable/disable nginx ingress controller installation
  enabled: false

# WSO2 APIM Control Plane configuration
apim:
  # Enable/disable APIM installation
  enabled: true
  
  aws:
    # -- If AWS is used as the cloud provider
    enabled: false
    efs:
      # -- EFS capacity
      capacity: ""
      # -- EFS directory permissions
      directoryPerms: "0777"
      # -- EFS file system ID for mounting the persistent volume
      fileSystemId: ""
      # -- EFS Access Points for static provisioning
      accessPoints:
        carbonDb: ""
        solr: ""
    # -- AWS region
    region: ""
    secretsManager:
      # -- AWS Secrets Manager secret provider class name
      secretProviderClass: "wso2am-am-secret-provider-class"
      secretIdentifiers:
        # -- Internal keystore password identifier in secrets manager
        internalKeystorePassword:
          # -- AWS Secrets Manager secret name
          secretName: ""
          # -- AWS Secrets Manager secret key
          secretKey: ""
    # Name of Kubernetes service account
    serviceAccountName: ""

  azure:
    # -- If Azure is used as the cloud provider
    enabled: false
    keyVault:
      # -- Azure Key vault used for credential management
      name: ""
      # -- Azure Key vault secret provider class name
      secretProviderClass: "wso2am-secret-provider-class"
      secretIdentifiers:
        # -- Internal keystore password identifier in keyvault
        internalKeystorePassword: ""
        # -- Internal keystore key password identifier in keyvault
        internalKeystoreKeyPassword: ""
      activeDirectory:
        # -- Service Principal created for transacting with the target Azure Key Vault
        # For advanced details refer to official documentation (https://github.com/Azure/secrets-store-csi-driver-provider-azure/blob/master/docs/service-principal-mode.md)
        servicePrincipal:
          # -- Application ID of the service principal used in secret-store-csi
          appId: ""
          # -- Client secret name of the service principal used in secret-store-csi
          clientSecretName: ""
          # -- Credentials secret name of the service principal used as nodePublisherRef
          credentialsSecretName: ""
        # -- Azure Active Directory tenant ID of the target Key Vault
        tenantId: ""
      resourceManager:
        # -- Subscription ID of the target Azure Key Vault
        subscriptionId: ""
        # -- Name of the Azure Resource Group to which the target Azure Key Vault belongs
        resourceGroup: ""
    serviceAccount: "wso2am-all-in-one-svc-account"
    persistence:
      # Needed for persisting indexing related data
      # -- Persistent volume capacity
      capacity: ""
      # -- Persistent volume storage class
      storageClass: ""
      # -- Azure file secret name
      secretName: ""
      # -- Azure fileshare name
      fileShare: ""

  # Google Cloud Platform (GCP) integration status
  gcp:
    # -- If GCP is used as the cloud provider
    enabled: false
    # -- File Store configuration parameters
    fs:
      # -- Storage capacity of the file system (in GB or other appropriate units)
      capacity: ""
      # -- FileStore configuration for specific services
      fileshares:
        # -- FileShare configs for CarbonDB persistent storage
        carbonDB:
          # -- FileStore of the CarbonDB persistent storage
          fileStoreName: ""
          # -- FileShare of the CarbonDB persistent storage
          fileShareName: ""
          # -- IP of the CarbonDB persistent storage
          ip: ""
        # -- FileShare configs for Solr persistent storage
        solr:
          # -- FileStore of the Solr persistent storage
          fileStoreName: ""
          # -- FileShare of the Solr persistent storage
          fileShareName: ""
          # -- IP of the Solr persistent storage
          ip: ""
      # -- Tier of the FileStore
      tier: ""
      # -- Network of the FileStore
      network: ""

      # -- Region of the FileStore
      location: ""

    # -- Secrets Manager configuration parameters
    secretsManager:
      # -- Project ID
      projectId: ""
      # -- Secret provider class
      secretProviderClass: ""
      secret:
        # -- Name of the secret
        secretName: ""
        # -- Version of the secret 
        secretVersion: ""
    # -- Service Account with access to read secrets
    serviceAccountName: ""

  kubernetes:
    # -- Ingress class to be used for the ingress resource
    ingressClass: "nginx"
    ingress:
      # -- Kubernetes secret created for Ingress TLS
      tlsSecret: ""
      ratelimit:
        # -- Ingress rate limit
        enabled: false
        # -- Ingress ratelimit zone name
        zoneName: ""
        # -- Ingress ratelimit burst limit
        burstLimit: ""
      management:
        enabled: true
        # Hostname for API Manager Carbon Management Console, Publisher, DevPortal and Admin Portal
        hostname: "am.wso2.com"
        # Annotations for the API Manager Publisher-DevPortal services Ingress
        annotations:
          nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
          nginx.ingress.kubernetes.io/affinity: "cookie"
          nginx.ingress.kubernetes.io/session-cookie-name: "route"
          nginx.ingress.kubernetes.io/session-cookie-hash: "sha1"
      gateway:
        enabled: true
        # -- Ingress hostname for Gateway pass-through
        hostname: "gw.wso2.com"
        # -- Ingress annotations for Gateway pass-through
        annotations:
          nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
          nginx.ingress.kubernetes.io/proxy-buffering: "on"
          nginx.ingress.kubernetes.io/proxy-buffer-size: "8k"
      websocket:
        enabled: true
        # -- Ingress hostname for Websocket
        hostname: "websocket.wso2.com"
        # -- Ingress annotations for Websocket
        annotations:
          #todo: add websocket specific annotations
      websub:
        enabled: true
        # -- Ingress hostname for Websub
        hostname: "websub.wso2.com"
        # -- Ingress annotations for Websub
        annotations:
    securityContext:
      # -- User ID of the container
      runAsUser: 10001
      runAsGroup: 10001
      # -- SELinux context for the container
      seLinux:
        enabled: false
        level: ""
      # -- Seccomp profile for the container
      seccompProfile:
        # -- Seccomp profile type(RuntimeDefault, Unconfined or Localhost)
        type: RuntimeDefault
        localhostProfile: ""
    # -- Set UNIX permissions over the executable scripts
    configMaps:
      scripts:
        defaultMode: "0407"


  wso2:
    # -- WSO2 Choreo Analytics Parameters
    # If provided, these parameters will be used publish analytics data to Choreo Analytics environment (https://apim.docs.wso2.com/en/latest/observe/api-manager-analytics/configure-analytics/register-for-analytics/).
    choreoAnalytics:
      enabled: false
      # -- Choreo Analytics cloud service endpoint
      endpoint: ""
      # -- On-premise key for Choreo Analytics
      onpremKey: ""

    # -- ELK Analytics Parameters
    ELKAnalytics:
      enabled: false

    # TOML configurations
    apim:
      # -- APIM version
      version: "4.5.0"
      # -- Secure vauld enabled
      secureVaultEnabled: false
      # Logging related configurations
      log4j2:
        # -- Console loggers that can be enabled. Allowed values are AUDIT_LOG_CONSOLE, HTTP_ACCESS_CONSOLE, TRANSACTION_CONSOLE, CORRELATION_CONSOLE
        loggers: ""
        # -- Appenders
        appenders: ""
      # -- Startup arguments for APIM
      startupArgs: ""
      # -- Port Offset for APIM deployment
      portOffset: 0
      # -- Startup script mount status
      mountStartupScript: false
      # -- Frontend settings.json mount status
      mountFrontendConfig: false
      # TOML configurations
      configurations:
        gatewayType: "Regular,APK"
        userStore:
          # -- User store type. 
          # https://apim.docs.wso2.com/en/latest/administer/managing-users-and-roles/managing-user-stores/configure-primary-user-store/configuring-the-primary-user-store/
          type: "database_unique_id"
          # -- User store properties
          properties:
            # key: value
        # -- Super admin username
        adminUsername: "admin"
        # -- Super admin password
        adminPassword: "admin"
        databases:
          # -- Database type. eg: mysql, oracle, mssql, postgres
          type: "h2"
          jdbc:
            # -- JDBC driver class name
            driver: "org.h2.Driver"
          # -- APIM APIMDB configurations. This is required for gateway only in a multi-tenancy scenario
          apim_db:
            # -- APIM APIMDB URL
            url: "jdbc:h2:./repository/database/WSO2AM_DB;DB_CLOSE_ON_EXIT=FALSE"
            # -- APIM APIMDB username
            username: "wso2carbon"
            # -- APIM APIMDB password
            password: "wso2carbon"
            # -- APIM database JDBC pool parameters
            poolParameters:
              defaultAutoCommit: true
              testOnBorrow: true
              testWhileIdle: true
              validationInterval: 30000
              maxActive: 100
              maxWait: 60000
              minIdle: 5
          shared_db:
            # -- APIM SharedDB URL
            url: "jdbc:h2:./repository/database/WSO2SHARED_DB;DB_CLOSE_ON_EXIT=FALSE"
            # -- APIM SharedDB username
            username: "wso2carbon"
            # -- APIM SharedDB password
            password: "wso2carbon"
            # -- APIM database JDBC pool parameters
            poolParameters:
              defaultAutoCommit: true
              testOnBorrow: true
              testWhileIdle: true
              validationInterval: 30000
              maxActive: 100
              maxWait: 60000
              minIdle: 5

        # -- APIM AI related configurations
        ai:
          enabled: false
          token: ""
          key: ""
          endpoint: ""
          token_endpoint: ""

        security:
          # -- Kubernetes secret containing the keystores and truststore
          jksSecretName: ""
          keystores:
            primary:
              # -- Primary keystore enabled
              enabled: false
              # -- Primary keystore name
              name: "wso2carbon.jks"
              # -- Primary keystore alias
              alias: "wso2carbon"
              # -- Primary keystore password
              password: "wso2carbon"
              # -- Primary keystore key password
              keyPassword: "wso2carbon"
            tls:
              # -- TLS keystore enabled
              enabled: true
              # -- TLS keystore name
              name: "wso2carbon.jks"
              # -- TLS keystore alias
              alias: "wso2carbon"
              # -- TLS keystore password
              password: "wso2carbon"
              # -- TLS keystore key password
              keyPassword: "wso2carbon"
            internal:
              # -- Internal keystore enabled
              enabled: false
              # -- Internal keystore name
              name: "wso2carbon.jks"
              # -- Internal keystore alias
              alias: "wso2carbon"
              # -- Internal keystore password
              password: "wso2carbon"
              # -- Internal keystore key password
              keyPassword: "wso2carbon"
          truststore:
            # -- Truststore name
            name: "client-truststore.jks"
            # -- Truststore password
            password: "wso2carbon"

        gateway:
          # -- APIM Gateway environments
          environments:
          - name: "Default"
            type: "hybrid"
            gatewayType: "Regular"
            provider: "wso2"
            visibility:
            displayInApiConsole: true
            description: "This is a hybrid gateway that handles both production and sandbox token traffic."
            showAsTokenEndpointUrl: true
            serviceName: "localhost"
            servicePort: 9443
            wsHostname: "websocket.wso2.com"
            httpHostname: "gw.wso2.com"
            websubHostname: "websub.wso2.com"
          - name: "Default_APK"
            type: "hybrid"
            gatewayType: "APK"
            provider: "wso2"
            displayInApiConsole: true
            description: "This is a kubernetes gateway that handles both production and sandbox token traffic."
            showAsTokenEndpointUrl: true
            httpHostname: "default.gw.wso2.com:9095"

        syncRuntimeArtifacts:
          gateway:
            # -- Gateway label used to filter out artifact retrieval
            labels: ["Default"]

        iskm:
          # If Identity Server is used as the Resident KM
          enabled: false
          # Kubernetes service name exposing Identity Server
          serviceName: ""
          # Revoke URL of Identity Server
          revokeURL: ""
        
        jwt:
          # Enable backend JWT generation in gateway
          enabled: false
          # JWT encoding algorithm. Can be either base64 or base64url
          encoding: "base64"
          # JWT header name.
          header: "X-JWT-Assertion"
          # JWT claim dialect
          claimDialect: "http://wso2.org/claims"
          # JWT signature algorithm. SHA256withRSA
          signingAlgorithm: "SHA256withRSA"
          # JWT generation implementation.
          generatorImpl: "org.wso2.carbon.apimgt.keymgt.token.JWTGenerator"
          # Enable end user claim mapping
          enableUserClaims: "false"
          # JWT claims extractor implementation. eg: org.wso2.carbon.apimgt.impl.token.DefaultClaimsRetriever
          claimsExtractorImpl: "org.wso2.carbon.apimgt.impl.token.DefaultClaimsRetriever"
        
        # APIM cache related configurations
        cache:
          gateway_token:
            # -- Gateway token cache enabled
            enabled: true
            # -- Gateway token cache expiration time
            expiryTime: "15m"
          resource:
            # -- Gateway resource cache enabled
            enabled: true
            # -- Gateway resource cache expiration time
            expiryTime: "900s"
          km_token:
            # -- Gateway KM token cache enabled
            enabled: true
            # -- Gateway KM token cache expiration time
            expiryTime: "15m"
          recent_apis:
            # -- Gateway recent APIs cache enabled
            enabled: false
          scopes:
            enabled: false
          publisher_roles:
            enabled: false
          jwt_claim:
            # -- Gateway JWT claim cache enabled
            enabled: true
            # -- Gateway JWT claim cache expiration time
            expiryTime: "15m"
          tags:
            # -- Gateway tags cache enabled
            enabled: true
            expiryTime: "2m"

        # APIM OAuth configurations
        oauth_config:
          # -- Remove auth header from outgoing requests
          removeOutboundAuthHeader: true
          # -- OAuth authorization header name
          authHeader: "Authorization"
          # -- OAuth revoke endpoint
          revokeEndpoint: ""
          # -- Enable token encryption
          enableTokenEncryption: false
          # -- Enable token hashing
          enableTokenHashing: false
          oauth2JWKSUrl: "http://wso2-apim-kubernetes-am-service:9763/oauth2/jwks"

        # APIM Devportal configurations
        devportal:
          enableApplicationSharing: 
          applicationSharingType: 
          applicationSharingImpl: 
          # -- Whether to display multiple versions of same API or only showing the latest version of an API
          displayMultipleVersions: 
          # -- Whether to display deprecated APIs
          displayDeprecatedApis: 
          # -- Whether to display comments for API
          enableComments: 
          # -- Whether to display ratings for API
          enableRatings: 
          # -- Whether to display forum for API
          enableForum: 
          # -- Whether anonymous mode is enabled
          enableAnonymousMode: 
          enableCrossTenantSubscriptions: 
          defaultReservedUsername: 
          # -- Whether to create default application
          create_default_application: 
          loginUsernameCaseInsensitive:
          enableKeyProvisioning:

        publisher:
          # -- Supported document types in Publisher. 
          # This should be used only if there are additional document types to be supported.
          enable_api_doc_visibility: false
          supportedDocumentTypes: ""
          enablePortalConfigurationOnlyMode: false
          internalKeyIssuer: ""

        # APIM CORS configurations
        cors:
          # -- CORS configuration enabled
          enabled: true
          # -- CORS Access-Control-Allow-Origin
          allowOrigins: ["*"]
          # -- CORS Access-Control-Allow-Methods
          allowMethods: ["GET","PUT","POST","DELETE","PATCH","OPTIONS"]
          # -- CORS Access-Control-Allow-Headers
          allowHeaders: ["authorization","Access-Control-Allow-Origin","Content-Type","SOAPAction","apikey","Internal-Key"]
          # -- CORS Access-Control-Allow-Credentials
          allowCredentials: false
          # -- Enable CORS for Websockets
          enableForWS: false

        throttling:
          enableDataPublishing: true
          enablePolicyDeploy: true
          enableBlacklistCondition: true
          enablePersistence: true
          throttleDecisionEndpoints: []
          enableUnlimitedTier: true
          enableHeaderBasedThrottling: false
          enableJwtClaimBasedThrottling: false
          enableQueryParamBasedThrottling: false
          blacklistCondition:
            startDelay: 
            period: 
          jms:
            startDelay: 
          eventSync:
            hostname: 
            port: 
          eventManagement:
            hostname: 
            port: 

        workflow:
          enable: false
          serviceUrl: ""
          callbackEndpoint: ""
          tokenEndpoint: ""
          clientRegistrationEndpoint: ""

        transport:
          receiver:
            type: ""
            workerThreads: 10
            sessionTimeout: ""
            keystore:
              fileName: "$ref{keystore.tls.file_name}"
              password: "$ref{keystore.tls.password}"
            tcpPort: 9611
            sslPort: 9711
            sslReceiverThreadPoolSize: 100
            tcpReceiverThreadPoolSize: 100
            sslEnabledProtocols:
              - "TLSv1"
              - "TLSv1.1"
              - "TLSv1.2"
            ciphers:
              - "SSL_RSA_WITH_RC4_128_MD5"
              - "SSL_RSA_WITH_RC4_128_SHA"
              
        token:
          revocation:
            NotifierImpl: "org.wso2.carbon.apimgt.keymgt.events.TokenRevocationNotifierImpl"
            EnableRealtimeNotifier: true
            RealtimeNotifierTtl: 5000
            EnablePersistentNotifier: true
            PersistentNotifierHostname: "https://localhost:2379/v2/keys/jti/"
            PersistentNotifierTtl: 5000
            PersistentNotifierUsername: "root"
            PersistentNotifierPassword: "root"

        notification:
          fromAddress: 
          username: 
          password: 
          signature: 
          hostname: 
          port: 25
          enableStartTls: false
          enableAuthentication: false

        eventHandlers:
          - name: "userPostSelfRegistration"
            subscriptions:
              - "POST_ADD_USER"

        serviceProvider:
          spNameRegex: "^[\\sa-zA-Z0-9._-]*$"

        eventListeners:
          - id: "token_revocation"
            type: "org.wso2.carbon.identity.core.handler.AbstractIdentityHandler"
            name: "org.wso2.is.notification.ApimOauthEventInterceptor"
            order: 1
            properties:
              notificationEndpoint: "https://localhost:${mgt.transport.https.port}/internal/data/v1/notify"

        keyManager:
          enableLightweightAPIKeyGeneration: true
          allowSubscriptionValidationDisabling: true

        transactionCounter:
          enabled: false
          serverId: "Gateway"
          serverUrl: ""

        governance:
          # -- Override the default values of governance.scheduler if any value exists
          scheduler:
            thread_pool_size: ""
            queue_size: ""
            task_check_interval_minutes: ""
            task_cleanup_interval_minutes: ""
        
        # APIM SDK configurations
        sdk:
          supportedLanguages: ["android", "java", "csharp", "dart", "groovy", "javascript", "jmeter", "perl", "php", "python", "ruby", "swift5", "clojure"]

        # Organization level access control configurations
        organization_based_access_control:
          enabled: true
          organization_name_local_claim: "http://wso2.org/claims/organization"
          organization_id_local_claim: "http://wso2.org/claims/organizationId" 

    deployment:
      # Container image configurations
      image:
        # -- Container registry credentials.
        # Specify image pull secrets for private registries
        imagePullSecrets:
          enabled: false
          username: ""
          password: ""
        # -- Registry containing the image
        registry: "docker.io"
        # -- Repository name consisting the image
        repository: "wso2/wso2am:4.6.0"
        # -- Docker image digest
        digest: "sha256:e2dc61ede174a49b6c99527bb7d1e188133dc72776850161e0118380ad0d1fe4"
        # -- Refer to the Kubernetes documentation on updating images (https://kubernetes.io/docs/concepts/containers/images/#updating-images)
        imagePullPolicy: Always

      resources:
        # These are the resource recommendations for running WSO2 API Management product profiles with profile optimization
        # Resource configurations defined here are applicable for all API Manager product profiles of this deployment
        requests:
          # -- Memory request for API Manager
          memory: "2Gi"
          # -- CPU request for API Manager
          cpu: "2000m"
        limits:
          # -- Memory limit for API Manager
          memory: "3Gi"
          # -- CPU limit for API Manager
          cpu: "3000m"
        jvm:
          memory:
            # -- JVM heap memory Xms
            xms: "2048m"
            # -- JVM heap memory Xmx
            xmx: "2048m"

      # Kubernetes Probes     
      # Indicates whether the container starting
      startupProbe:
        # -- Number of seconds after the container has started before startup probes are initiated
        initialDelaySeconds: 60
        # -- How often (in seconds) to perform the probe
        periodSeconds: 10
        # -- Minimum consecutive successes for the probe to be considered successful after having failed
        failureThreshold: 5
      # Indicates whether the container is running
      livenessProbe:
        # -- Number of seconds after the container has started before liveness probes are initiated
        initialDelaySeconds: 60
        # -- How often (in seconds) to perform the probe
        periodSeconds: 10
        # -- Minimum consecutive successes for the probe to be considered successful after having failed
        failureThreshold: 5
      # Indicates whether the container is ready to service requests
      readinessProbe:
        # -- Number of seconds after the container has started before readiness probes are initiated
        initialDelaySeconds: 60
        # -- How often (in seconds) to perform the probe
        periodSeconds: 10
        # -- Minimum consecutive successes for the probe to be considered successful after having failed
        failureThreshold: 5
      lifecycle:
        preStopHook:
          # -- Time to wait until the apim is terminated gracefully
          sleepSeconds: 10

      # -- Minimum available pod counts for PDB
      minAvailable: "50%"

      # -- Node selector to deploy pod in selected node. Add label to the node and specify the label here.
      nodeSelector:

      persistence:
        # -- Persistent runtime artifacts for Apache Solr-based indexing
        solrIndexing:
          # -- Indicates if persistence of the runtime artifacts for Apache Solr-based indexing is enabled
          # By default, this is disabled
          enabled: false
          # Define capacities for persistent runtime artifact directories
          capacity:
            # -- For persisting the H2 based local Carbon database file
            carbonDatabase: 50M
            # -- For persisting the indexed solr data
            solrIndexedData: 50M

# WSO2 APK configuration  
apk:
  # Enable/disable APK installation
  enabled: true
  
  wso2:
    subscription:
      imagePullSecrets: ""

    apk:
      helmHooks:
        webhooksCleanupEnabled: true
        webhooksCleanup:
          enabled : true
          image: "bitnamilegacy/kubectl:1.31.1"
      webhooks:
        validatingwebhookconfigurations: true
        mutatingwebhookconfigurations: true
        conversionwebhookconfigurations: true
      auth:
        enabled: true
        enableServiceAccountCreation: true
        enableClusterRoleCreation: true
        serviceAccountName: wso2apk-platform
        roleName: wso2apk-role
      listener:
        hostname: "api.am.wso2.com"
        port: 9095
        # secretName: "idp-tls"
      idp:
        issuer: "https://idp.am.wso2.com/token"
        usernameClaim: "sub"
        organizationClaim: "organization"
        groupsClaim: "groups"
        consumerKeyClaim: "clientId"
        # organizationResolver: "controlPlane" # controlplane,none
        # tls:
        #   secretName: "wso2apk-idp-certificates"
        #   fileName: "idp.crt"
        # signing:
        #   jwksEndpoint: "https://idp.am.wso2.com:9095/oauth2/jwks"
        #   secretName: "wso2apk-idp-signing"
        #   fileName: "idp.crt"
      cp:
        enabledSubscription: true
        host: "apim-apk-agent-service.apim-kubernetes.svc.cluster.local"
        skipSSLVerification: true
      #   persistence:
      #     type: "K8s"
      dp:
        enabled: true
        gateway:
          listener:
            hostname: "gw.wso2.com"
          service: {}
            # secretName: "idp-tls"
        # partitionServer:
        #   enabled: false
        #   host: "https://control-plane-wso2-apk-partition-server.control-plane.svc.cluster.local"
        #   serviceBasePath: "/api/publisher/v1"
        #   partitionName: "default"
        #   hostnameVerificationEnable: true
        #   tls:
        #     secretName: "partition-server-cert"
        #     fileName: "certificate.crt"
        #   headers:
        #     - name: "apiKey"
        #       value: "123-456-789"
        configdeployer:
          enabled: true
          deployment:
            resources:
              requests:
                memory: "512Mi"
                cpu: "200m"
              limits:
                memory: "1024Mi"
                cpu: "500m"
            readinessProbe:
              initialDelaySeconds: 20
              periodSeconds: 20
              failureThreshold: 5
            livenessProbe:
              initialDelaySeconds: 20
              periodSeconds: 20
              failureThreshold: 5
            strategy: RollingUpdate
            replicas: 1
            imagePullPolicy: Always
            image: wso2/apk-config-deployer-service:1.3.0
          # debug: true
            # configs:
            #   tls:
            #     secretName: "my-secret"
            #     certKeyFilename: "tls.key"
            #     certFilename: "certchain.crt"
        adapter:
          deployment:
            resources:
              requests:
                memory: "64Mi"
                cpu: "50m"
              limits:
                memory: "128Mi"
                cpu: "200m"
            readinessProbe:
              initialDelaySeconds: 20
              periodSeconds: 20
              failureThreshold: 5
            livenessProbe:
              initialDelaySeconds: 20
              periodSeconds: 20
              failureThreshold: 5
            strategy: RollingUpdate
            replicas: 1
            imagePullPolicy: Always
            image: wso2/apk-adapter:1.3.0
            security:
              sslHostname: "adapter"
            logging:
              level: "DEBG" # LogLevels can be "DEBG", "FATL", "ERRO", "WARN", "INFO", "PANC"
          # #          logFormat: "TEXT" # Values can be "JSON", "TEXT"
            configs: 
              enableGatewayClassController: false
          #   apiNamespaces:
          #     - "apk-v12"
          #   tls:
          #     secretName: "adapter-cert"
          #     certKeyFilename: ""
          #     certFilename: ""
        commonController:
          deployment:
            resources:
              requests:
                memory: "64Mi"
                cpu: "50m"
              limits:
                memory: "128Mi"
                cpu: "200m"
            readinessProbe:
              initialDelaySeconds: 20
              periodSeconds: 20
              failureThreshold: 5
            livenessProbe:
              initialDelaySeconds: 20
              periodSeconds: 20
              failureThreshold: 5
            strategy: RollingUpdate
            replicas: 1
            imagePullPolicy: Always
            image: wso2/apk-common-controller:1.3.0
            security:
              sslHostname: "commoncontroller"
            # configs:
            #   apiNamespaces:
            #     - "apk-v12"
        ratelimiter:
          enabled: true
          deployment:
            resources:
              requests:
                memory: "64Mi"
                cpu: "50m"
              limits:
                memory: "128Mi"
                cpu: "100m"
            readinessProbe:
              initialDelaySeconds: 20
              periodSeconds: 20
              failureThreshold: 5
            livenessProbe:
              initialDelaySeconds: 20
              periodSeconds: 20
              failureThreshold: 5
            strategy: RollingUpdate
            replicas: 1
            imagePullPolicy: Always
            image: wso2/apk-ratelimiter:1.3.0
            security:
              sslHostname: "ratelimiter"
            # configs:
            #   tls:
            #     secretName: "ratelimiter-cert"
            #     certKeyFilename: ""
            #     certFilename: ""
            #     certCAFilename: ""
        gatewayRuntime:
          deployment:
            replicas: 1
            router:
              resources:
                requests:
                  memory: "128Mi"
                  cpu: "200m"
                limits:
                  memory: "1028Mi"
                  cpu: "1000m"
              readinessProbe:
                initialDelaySeconds: 20
                periodSeconds: 20
                failureThreshold: 5
              livenessProbe:
                initialDelaySeconds: 20
                periodSeconds: 20
                failureThreshold: 5
              strategy: RollingUpdate
              imagePullPolicy: Always
              image: wso2/apk-router:1.3.0
              # configs:
              #   tls:
              #     secretName: "router-cert"
              #     certKeyFilename: ""
              #     certFilename: ""
              #     logging:
              #       wireLogs:
              #         enable: true
              #       accessLogs:
              #         enable: true
              #     env:
              #       TRAILING_ARGS: "--log-level trace"
            enforcer:
              resources:
                requests:
                  memory: "128Mi"
                  cpu: "200m"
                limits:
                  memory: "512Mi"
                  cpu: "500m"
              readinessProbe:
                initialDelaySeconds: 20
                periodSeconds: 20
                failureThreshold: 5
              livenessProbe:
                initialDelaySeconds: 20
                periodSeconds: 20
                failureThreshold: 5
              strategy: RollingUpdate
              imagePullPolicy: Always
              image: wso2/apk-enforcer:1.3.0
              security:
                sslHostname: "enforcer"
  #            logging:
  #              level: DEBUG
              env:
                TOKEN_REVOCATION_ENABLED: "true" 
  #            configs:
  #              apiKey:
  #                enabled: true
  #                issuer: "https://localhost:9444/oauth2/token"
  #              tls:
  #                secretName: "router-cert"
  #                certKeyFilename: ""
  #                certFilename: ""
  #              JWKSClient:
  #                skipSSLVerification: false
  #                hostnameVerifier: "AllowAll"

      metrics:
        enabled: false
        # configDSBalHost: 0.0.0.0
        # idpDSBalHost: 0.0.0.0
        # statsd:
        #   image:
        #     repository: prom/statsd-exporter
        #     tag: v0.26.0
        #   imagePullPolicy: Always
        #   resources:
        #     limits:
        #       memory: 128Mi
        #     requests:
        #       cpu: 0.1
        #       memory: 64Mi
  idp:
    enabled: true
    listener:
      hostname: "idp.am.wso2.com"
      # secretName: "idp-tls"
    database:
      driver: "org.postgresql.Driver"
      url: "jdbc:postgresql://wso2apk-db-service:5432/WSO2AM_DB"
      host: "wso2apk-db-service"
      port: 5432
      databaseName: "WSO2AM_DB"
      username: "wso2carbon"
      secretName: "apk-db-secret"
      secretKey: "DB_PASSWORD"
      validationQuery: "SELECT 1"
      validationTimeout: 250
    idpds:
      configs:
        issuer: "https://idp.am.wso2.com/token"
        keyId: "gateway_certificate_alias"
        hostname: "idp.am.wso2.com"
        loginPageURl: "https://idp.am.wso2.com:9095/authenticationEndpoint/login"
        loginErrorPageUrl: "https://idp.am.wso2.com:9095/authenticationEndpoint/error"
        loginCallBackURl: "https://idp.am.wso2.com:9095/authenticationEndpoint/login-callback"
      deployment:
        resources:
          requests:
            memory: "512Mi"
            cpu: "200m"
          limits:
            memory: "1024Mi"
            cpu: "500m"
        readinessProbe:
          initialDelaySeconds: 20
          periodSeconds: 20
          failureThreshold: 5
        livenessProbe:
          initialDelaySeconds: 20
          periodSeconds: 20
          failureThreshold: 5
        strategy: RollingUpdate
        replicas: 1
        imagePullPolicy: Always
        image: wso2/apk-idp-domain-service:1.3.0
    idpui:
      deployment:
        resources:
          requests:
            memory: "64Mi"
            cpu: "50m"
          limits:
            memory: "256Mi"
            cpu: "100m"
        readinessProbe:
          initialDelaySeconds: 20
          periodSeconds: 20
          failureThreshold: 5
        livenessProbe:
          initialDelaySeconds: 20
          periodSeconds: 20
          failureThreshold: 5
        strategy: RollingUpdate
        replicas: 1
        imagePullPolicy: Always
        image: wso2/apk-idp-ui:1.3.0
      configs:
        idpLoginUrl: "https://idp.am.wso2.com:9095/commonauth/login"
        idpAuthCallBackUrl: "https://idp.am.wso2.com:9095/oauth2/auth-callback"

  gatewaySystem:
    enabled: true
    enableServiceAccountCreation: true
    enableClusterRoleCreation: true
    serviceAccountName: gateway-api-admission
    applyGatewayWehbhookJobs: true
    deployment:
      image: registry.k8s.io/gateway-api/admission-server:v1.0.0
      imagePullPolicy: Always

  certmanager:
    enabled: true
    enableClusterIssuer: true
    enableRootCa: true
    rootCaSecretName: "apk-root-certificate"

  postgresql:
    enabled: true
    fullnameOverride: "wso2apk-db-service"
    auth:
      database: WSO2AM_DB
      postgresPassword: wso2carbon
      username: wso2carbon
      password: wso2carbon
    primary:
      extendedConfiguration: |
        max_connections = 400
      initdb:
        scriptsConfigMap: postgres-initdb-scripts-configmap
        user: wso2carbon
        password: wso2carbon
      service:
        ports:
          postgresql: 5432
      podSecurityContext:
        enabled: true
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault
      containerSecurityContext:
        enabled: true
        allowPrivilegeEscalation: false
        capabilities:
          drop: ["ALL"]
        runAsUser: null

    image:
      debug: true
      # Use bitnamilegacy images as all existing container images have been migrated from the public catalog (docker.io/bitnami) to the “Bitnami Legacy” repository (docker.io/bitnamilegacy)
      repository: "bitnamilegacy/postgresql"

  redis:
    enabled: true
    architecture: standalone
    fullnameOverride: redis
    primary:
      service:
        ports:
          redis: 6379
    master:
      podSecurityContext:
        enabled: true
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault
      containerSecurityContext:
        enabled: true
        allowPrivilegeEscalation: false
        capabilities:
          drop: ["ALL"]
        runAsUser: null
    auth:
      enabled: false
      usePasswordFiles: false
    image:
      debug: true
      # Use bitnamilegacy images as all existing container images have been migrated from the public catalog (docker.io/bitnami) to the “Bitnami Legacy” repository (docker.io/bitnamilegacy)
      repository: "bitnamilegacy/redis"

  # This is to use bitnamilegacy images.
  global:
    security:
      allowInsecureImages: true

# WSO2 APIM APK Agent configuration
apkagent:
  # Enable/disable APK Agent installation
  enabled: true
  
  wso2:
    subscription:
      imagePullSecrets: ""
  replicaCount: 1
  image:
    repository: wso2/apim-apk-agent
    tag: 1.3.0
    pullPolicy: Always
  service:
    name: apim-apk-agent-service
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"
  controlPlane:
    enabled: true
    serviceURL: https://wso2-apim-kubernetes-am-service.apim-kubernetes.svc.cluster.local:9443/
    username: admin
    password: admin
    environmentLabels: Default_APK
    skipSSLVerification: true
    eventListeningEndpoints: amqp://admin:admin@wso2-apim-kubernetes-am-service.apim-kubernetes.svc.cluster.local:5672?retries='10'&connectdelay='30'
    # internalKeyIssuer: http://am.wso2.com:443/token
  dataPlane:
    enabled: true
    k8ResourceEndpoint: https://apk-wso2-apk-config-ds-service.apim-kubernetes.svc.cluster.local:9443/api/configurator/apis/generate-k8s-resources
    namespace: apim-kubernetes
  metrics:
    enabled: false
  agent:
    mode: CPtoDP
  certmanager:
    enabled: false
  serviceAccount:
    enableServiceAccountCreation: true
    enableClusterRoleCreation: true
    serviceAccountName: wso2agent-platform
    roleName: wso2agent-role

# Global overrides (optional)
# These will be available to all sub-charts
global:
  security:
    allowInsecureImages: true
  # Example:
  # storageClass: "standard"

# GCP Marketplace Configuration
# Required for billing tracking
marketplace:
  serviceName: "wso2-apim-kubernetes"
  serviceLevel: "default"

