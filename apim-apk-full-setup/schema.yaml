x-google-marketplace:
  schemaVersion: v2
  applicationApiVersion: v1beta1
  publishedVersion: "4.5.0"
  publishedVersionMetadata:
    releaseNote: >-
      Initial release of WSO2 APIM Kubernetes deployment with support for
      API Manager Control Plane (ACP), API Platform for Kubernetes (APK),
      and APK Agent integration on Google Cloud Platform.
    releaseTypes:
      - Feature
    recommended: false

  images:
    wso2am-acp:
      properties:
        wso2amAcpImage:
          type: FULL
    apk-config-deployer-service:
      properties:
        configDeployerImage:
          type: FULL
    apk-adapter:
      properties:
        adapterImage:
          type: FULL
    apk-common-controller:
      properties:
        commonControllerImage:
          type: FULL
    apk-ratelimiter:
      properties:
        ratelimiterImage:
          type: FULL
    apk-router:
      properties:
        routerImage:
          type: FULL
    apk-enforcer:
      properties:
        enforcerImage:
          type: FULL
    apim-apk-agent:
      properties:
        apimApkAgentImage:
          type: FULL

  deployerServiceAccount:
    description: >
      Deployer service account for installing WSO2 APIM APK, including CRDs, RBAC resources, and cluster-wide configurations.
    roles:
      - type: ClusterRole
        rulesType: CUSTOM
        rules:
          - apiGroups: ["apiextensions.k8s.io"]
            resources: ["customresourcedefinitions"]
            verbs: ["*"]
          - apiGroups: ["rbac.authorization.k8s.io"]
            resources:
              ["clusterroles", "clusterrolebindings", "roles", "rolebindings"]
            verbs:
              ["get", "list", "watch", "create", "update", "patch", "delete"]
          - apiGroups: [""]
            resources:
              [
                "services",
                "configmaps",
                "secrets",
                "serviceaccounts",
                "persistentvolumeclaims",
                "pods",
                "namespaces",
              ]
            verbs: ["get", "list", "watch", "update", "delete", "create"]
          - apiGroups: ["apps"]
            resources: ["deployments", "statefulsets", "replicasets"]
            verbs:
              ["get", "list", "watch", "create", "update", "patch", "delete"]
          - apiGroups: ["batch"]
            resources: ["jobs"]
            verbs:
              ["get", "list", "watch", "create", "update", "patch", "delete"]
          - apiGroups: ["networking.k8s.io"]
            resources: ["ingresses", "networkpolicies"]
            verbs:
              ["get", "list", "watch", "create", "update", "patch", "delete"]
          - apiGroups: ["policy"]
            resources: ["podsecuritypolicies"]
            verbs:
              [
                "get",
                "list",
                "watch",
                "create",
                "update",
                "patch",
                "delete",
                "use",
              ]
          - apiGroups: ["admissionregistration.k8s.io"]
            resources:
              [
                "mutatingwebhookconfigurations",
                "validatingwebhookconfigurations",
              ]
            verbs:
              ["get", "list", "watch", "create", "update", "patch", "delete"]
          - apiGroups: ["cert-manager.io"]
            resources: ["certificates", "issuers", "clusterissuers"]
            verbs:
              ["get", "list", "watch", "create", "update", "patch", "delete"]
          - apiGroups: ["coordination.k8s.io"]
            resources: ["leases"]
            verbs:
              ["get", "list", "watch", "update", "patch", "create", "delete"]
          - apiGroups: ["gateway.networking.k8s.io"]
            resources:
              [
                "httproutes",
                "gateways",
                "gatewayclasses",
                "grpcroutes",
                "httproutes/status",
                "gateways/status",
                "gatewayclasses/status",
              ]
            verbs:
              ["get", "list", "watch", "create", "update", "patch", "delete"]
          - apiGroups: ["dp.wso2.com"]
            resources: ["*"]
            verbs: ["*"]
          - apiGroups: ["cp.wso2.com"]
            resources: ["*"]
            verbs: ["*"]

properties:
  controller.serviceAccount:
    type: string
    x-google-marketplace:
      type: SERVICE_ACCOUNT
      serviceAccount:
        description: Service account for API controller
        roles:
          - type: ClusterRole
            rulesType: CUSTOM
            rules:
              - apiGroups: ["apiextensions.k8s.io"]
                resources: ["customresourcedefinitions"]
                verbs: ["*"]
              - apiGroups: ["rbac.authorization.k8s.io"]
                resources:
                  [
                    "clusterroles",
                    "clusterrolebindings",
                    "roles",
                    "rolebindings",
                  ]
                verbs:
                  [
                    "get",
                    "list",
                    "watch",
                    "create",
                    "update",
                    "patch",
                    "delete",
                  ]
              - apiGroups: [""]
                resources:
                  [
                    "services",
                    "configmaps",
                    "secrets",
                    "serviceaccounts",
                    "persistentvolumeclaims",
                    "pods",
                    "namespaces",
                  ]
                verbs: ["get", "list", "watch", "update", "delete", "create"]
              - apiGroups: ["apps"]
                resources: ["deployments", "statefulsets", "replicasets"]
                verbs:
                  [
                    "get",
                    "list",
                    "watch",
                    "create",
                    "update",
                    "patch",
                    "delete",
                  ]
              - apiGroups: ["batch"]
                resources: ["jobs"]
                verbs:
                  [
                    "get",
                    "list",
                    "watch",
                    "create",
                    "update",
                    "patch",
                    "delete",
                  ]
              - apiGroups: ["networking.k8s.io"]
                resources: ["ingresses", "networkpolicies"]
                verbs:
                  [
                    "get",
                    "list",
                    "watch",
                    "create",
                    "update",
                    "patch",
                    "delete",
                  ]
              - apiGroups: ["policy"]
                resources: ["podsecuritypolicies"]
                verbs:
                  [
                    "get",
                    "list",
                    "watch",
                    "create",
                    "update",
                    "patch",
                    "delete",
                    "use",
                  ]
              - apiGroups: ["admissionregistration.k8s.io"]
                resources:
                  [
                    "mutatingwebhookconfigurations",
                    "validatingwebhookconfigurations",
                  ]
                verbs:
                  [
                    "get",
                    "list",
                    "watch",
                    "create",
                    "update",
                    "patch",
                    "delete",
                  ]
              - apiGroups: ["cert-manager.io"]
                resources: ["certificates", "issuers", "clusterissuers"]
                verbs:
                  [
                    "get",
                    "list",
                    "watch",
                    "create",
                    "update",
                    "patch",
                    "delete",
                  ]
              - apiGroups: ["gateway.networking.k8s.io"]
                resources: ["httproutes", "gateways", "gatewayclasses"]
                verbs: ["get", "list", "watch", "update", "delete", "create"]
              - apiGroups: ["gateway.networking.k8s.io"]
                resources: ["gateways/status"]
                verbs: ["get", "patch", "update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["apis"]
                verbs: ["get", "list", "watch", "update", "delete", "create"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["apis/finalizers"]
                verbs: ["update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["apis/status"]
                verbs: ["get", "patch", "update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["authentications"]
                verbs: ["get", "list", "watch", "update", "delete", "create"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["authentications/finalizers"]
                verbs: ["update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["authentications/status"]
                verbs: ["get", "patch", "update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["backends"]
                verbs: ["get", "list", "watch", "update", "delete", "create"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["backends/finalizers"]
                verbs: ["update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["backends/status"]
                verbs: ["get", "patch", "update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["apipolicies"]
                verbs: ["get", "list", "watch", "update", "delete", "create"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["apipolicies/finalizers"]
                verbs: ["update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["apipolicies/status"]
                verbs: ["get", "patch", "update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["interceptorservices"]
                verbs: ["get", "list", "watch", "update", "delete", "create"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["interceptorservices/finalizers"]
                verbs: ["update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["interceptorservices/status"]
                verbs: ["get", "patch", "update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["scopes"]
                verbs: ["get", "list", "watch", "update", "delete", "create"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["scopes/finalizers"]
                verbs: ["update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["scopes/status"]
                verbs: ["get", "patch", "update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["ratelimitpolicies"]
                verbs: ["get", "list", "watch", "update", "delete", "create"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["ratelimitpolicies/finalizers"]
                verbs: ["update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["ratelimitpolicies/status"]
                verbs: ["get", "patch", "update"]
              - apiGroups: ["coordination.k8s.io"]
                resources: ["leases"]
                verbs:
                  [
                    "get",
                    "list",
                    "watch",
                    "update",
                    "patch",
                    "create",
                    "delete",
                  ]
              - apiGroups: ["dp.wso2.com"]
                resources: ["tokenissuers"]
                verbs: ["get", "list", "watch", "update", "delete", "create"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["tokenissuers/finalizers"]
                verbs: ["update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["tokenissuers/status"]
                verbs: ["get", "patch", "update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["backendjwts"]
                verbs: ["get", "list", "watch", "update", "delete", "create"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["backendjwts/finalizers"]
                verbs: ["update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["backendjwts/status"]
                verbs: ["get", "patch", "update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["gqlroutes"]
                verbs: ["get", "list", "watch", "update", "delete", "create"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["gqlroutes/finalizers"]
                verbs: ["update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["gqlroutes/status"]
                verbs: ["get", "patch", "update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["aiproviders"]
                verbs: ["get", "list", "watch", "update", "delete", "create"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["aiproviders/status"]
                verbs: ["get", "patch", "update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["aiproviders/finalizers"]
                verbs: ["update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["airatelimitpolicies"]
                verbs: ["get", "list", "watch", "update", "delete", "create"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["airatelimitpolicies/finalizers"]
                verbs: ["update"]
              - apiGroups: ["dp.wso2.com"]
                resources: ["airatelimitpolicies/status"]
                verbs: ["get", "patch", "update"]
  name:
    type: string
    x-google-marketplace:
      type: NAME
    title: Application name
    description: The name of the application instance

  namespace:
    type: string
    x-google-marketplace:
      type: NAMESPACE
    title: Namespace
    description: The Kubernetes namespace where the application will be deployed
required:
  - name
  - namespace
